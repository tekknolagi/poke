\input texinfo.tex @c This is -*- Texinfo -*-.

@c This file is part of the JitterLisp manual, which is part of Jitter.
@c Copyright (C) 2017, 2018  Luca Saiu
@c Written by Luca Saiu

@c Permission is granted to copy, distribute and/or modify this
@c document under the terms of the GNU Free Documentation License,
@c Version 1.3 or any later version published by the Free Software
@c Foundation; with no Invariant Sections, no Front-Cover Texts, and
@c no Back-Cover Texts.  A copy of the license is included in the
@c section entitled ``GNU Free Documentation License''.


@c Conditionals
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@c @set this if building a preview for myself rather than a nice clean manual
@c to be distributed.
@c @set preview

@c @set This if I decide to include license texts.  It will look silly unless
@c the manual is long.
@c @set includelicenses


@c Index settings which must come early
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@c Define a symbol index, with entries typeset in @code .
@defcodeindex sy

@c @c Add index entries for symbols to the concept index as well.
@c @syncodeindex sy cp


@c File name and title
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@setfilename jitterlisp.info
@include version-jitterlisp.texi
@settitle JitterLisp @value{VERSION}


@c Global settings
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@syncodeindex pg cp
@documentencoding UTF-8

@ignore
@fonttextsize 10
@afivepaper
@smallbook
@c @pagesizes 200mm,100mm
@c @cropmarks
@end ignore

@c This is for production of a nice manual; I might want to enable it
@c when the actual manual is written.  The default (start chapters on
@c pages of any parity) looks less nice.
@ifclear preview
@setchapternewpage odd
@end ifclear @c preview

@c This come in handy for private testing printouts.
@ifset preview
@setchapternewpage off
@end ifset @c preview

@c Information for the Info directory
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@dircategory Programming
@direntry
* The JitterLisp manual: (jitterlisp).  An efficient Lisp system using a Jittery VM.
* @command{jitterlisp}:  (jitterlisp).  Invoking @command{jitterlisp}.
@end direntry


@c Macros
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@iftex
@macro epsilonsubscript{subscript}
@inlineraw{tex,$@varepsilon_{\subscript\}$}@inlineraw{tex,{}}
@end macro
@end iftex

@ifnottex
@ifhtml
@macro epsilonsubscript{subscript}
@inlineraw{html,&epsilon;<sub>\subscript\</sub>}
@end macro
@end ifhtml
@ifnothtml
@macro epsilonsubscript{subscript}
epsilon\subscript\
@end macro
@end ifnothtml
@end ifnottex

@macro epsilonzero{}
@epsilonsubscript{0}
@end macro

@macro epsilonone{}
@epsilonsubscript{1}
@end macro

@rmacro fixme{text}
@strong{[@emph{FIXME}: \text\]}
@end rmacro

@rmacro rephrase{text}
@strong{[@emph{REPHRASE}: \text\]}
@end rmacro


@c Copying conditions
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@copying
This is the manual for JitterLisp
@c (edition @value{EDITION} for
(version @value{VERSION},
last updated on @value{UPDATED}), an efficient Lisp system using a Jittery VM.

Copyright @copyright{} 2018  Luca Saiu.  Written by Luca Saiu.

@quotation
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation;
@ifset includelicenses
  with the Invariant Sections being ``GNU General Public License'' and
  ``GNU Free Documentation License'',
@end ifset @c includelicenses
with no Front-Cover texts and with the Back-Cover text being
``@emph{You have freedom to copy and modify this manual, like GNU
software.}''.

A copy of the GNU Free Documentation License is
@ifset includelicenses
  included in this book in the appendix entitled ``GNU Free
  Documentation License'', and the license text is also
@end ifset @c includelicenses
distributed in electronic form along with the software in the file
@file{doc/COPYING.DOC} and available on the web at the URL
@url{https://www.gnu.org/licenses/fdl.html}.
@end quotation

@c @c FIXME[contactingme] Isn't this silly?  My contact information is on the cover.
The author's personal web site @url{http://ageinghacker.net} contains
his contact information.
@end copying


@c Title page
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@titlepage
@title JitterLisp
@subtitle for version @value{VERSION}, updated in @value{UPDATED-MONTH}
@c @author Luca Saiu (@email{positron@@gnu.org}, @url{http://ageinghacker.net})
@c @author Luca Saiu (@url{http://ageinghacker.net})
@c @author Luca Saiu (@email{positron@@gnu.org})
@author Luca Saiu (@email{positron@@gnu.org})
@page
@vskip 0pt plus 1filll
@insertcopying
@end titlepage


@c Contents (only actually used for the hardcopy version)
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@contents


@c First page for the Info version, with the main menu
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@ifnottex
@node Top
@top JitterLisp

@c An @insertcopying within the Top node is not explicitly mandated by
@c the GNU Standards, nor even suggested in the Texinfo documentation;
@c however without such a line the Info and HTML versions don't bear any
@c copying information near the beginning.  Notice that the very short
@c introduction about what the software is comes from @copying.
@insertcopying
@end ifnottex

@menu
@c What this software is and how it came to be
* Introduction::                   What JitterLisp is and why you should care.
* Using JitterLisp::               How to build and run the software..

Reference documentation
* Lisp data::                      The possible shapes of Lisp objects.
* Lisp language reference::        About the JitterLisp language.
* Lisp language form reference::   The JitterLisp predefined language constructs.
* Lisp library reference::         What predefined globals do.

* Internals::                      How JitterLisp works under the hood.
@c Licenses
@c * GNU General Public License::     How you can share and modify the software.
@c * GNU Free Documentation License:: How you can share and modify this manual.
@ifset includelicenses

Licenses
* GNU General Public License::     How you can share and modify the software.
* GNU Free Documentation License:: How you can share and modify this manual.
@end ifset @c includelicenses

Indices
* Symbol index::                   A link to the documentation for each predefined global
                                   variable.
* Concept index::                  The key words of this manual, with links.

@ifset preview
Temporary stuff, for myself
* Stuff still to be written:: What will be in this manual but is not fully written yet.
* Stuff still to be implemented:: What will exist in the implementation in the future.
@end ifset @c preview
@end menu


@c Introduction
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@c The introduction is written in the first person singular, and uses
@c a more informal tone than the rest.  The clear fracture in style
@c from the introduction to the first chapter is intentional, meant to
@c convey first a more personal, vaguely sentimental touch, and then
@c the reliable terseness of comprehensive documentation.  This
@c distinction should be kept.

@node Introduction
@unnumbered Introduction

JitterLisp is a comparatively simple and efficient Lisp system,
relying on the Jitter virtual machine generator for compiling code.

@menu
* History::                            Why I though the world needed another Lisp.
* Features and influences::            What JitterLisp can do and where it comes from.
* License::                            JitterLisp is released under the GNU GPLv3+.
@end menu

@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node History
@section History
@cindex history
@cindex epsilon
@cindex GNU epsilon
@cindex @ @epsilonzero{} @c The initial forced space is less ugly than the alternative.

@fixme{@pxref{Top,,, jitter, The Jitter Manual}}
The programming language GNU epsilon (@pxref{Top,,, epsilon, The GNU
epsilon Manual}), my main long-term project, has yet to live to my
expectations.  And even if I keep believing in the superiority of its
design, as I firmly do, epsilon's concrete implementation still looks
like a promise waiting to be fulfilled.

@ignore
epsilon is written in itself, and every language form seen by the user
is a syntactic extension rewriting to fundamental forms or, more
typically, to other syntactic extensions.
@end ignore
Among the missed opportunities in epsilon its performance has always
bothered me.  If on one hand there are good technical reasons making
high efficiency more difficult to achieve in epsilon than in other
systems, on the other I conceived its architecture with that end,
amongst others, always in mind, to be competitive with the best.

@fixme{shorten this paragraph: there's no need to talk of
the first failed attempt.}
In late 2015 I decided to implement a direct-threaded virtual machine
for epsilon mostly intended to make interactive usage more convenient
and to reduce bootstrap time.  The speedup I obtained, about 4-6x, was
disappointing.

At that point I made a new repository and started experimenting with
more advanced VM techniques, reading the scientific literature and
adding ideas of my own.  That second more ambitious experiment
succeeded and eventually grew into an independent project, Jitter.

@fixme{Go on.}


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Features and influences
@section Features and influences
@cindex feature
@cindex influences
@cindex Common Lisp
@cindex Scheme

@fixme{Write this}

@menu
* Comparison with other Lisps::     Some features come from Common Lisp and Scheme.
* Simplifications::                 What JitterLisp lacks and why.
* epsilonian features::             Others are reminiscent of GNU epsilon.
@end menu


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Comparison with other Lisps
@subsection Comparison with other Lisps

@fixme{@code{define} operating at the top level, like Common Lisp's
@code{defun} but differently from Scheme}

@fixme{both interpreted and compiled closures, like in many Common Lisp
implementations, interoperable; compilation on the fly}

@fixme{proper sibling call support like in Scheme, except when calling
compiled code from interpreted code or vice-versa}

@fixme{quoting and quasiquoting are Lispy, not epsilonian}


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Simplifications
@subsection Simplifications

@menu
* Intentionally omitted features::            What I didn't include, on purpose.
* Desirable but not implemented features::    What I would like to include.
@end menu

@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Intentionally omitted features
@subsubsection Intentionally omitted features

@fixme{no modules, packages or namespaces}

@syindex values@r{ (non-existing form)}
@fixme{no @code{values}}

@syindex call/cc@r{ (non-existing form)}
@fixme{no continuations}

@syindex throw@r{ (non-existing form)}
@syindex catch@r{ (non-existing form)}
@fixme{no exceptions}

@cindex variadic, procedure (non-existing)
@fixme{no variadic procedures (but I do have variadic macros)}

@fixme{no OO}

@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Desirable but not implemented features
@subsubsection Desirable but not implemented features

@fixme{no stack traces}

@fixme{no type dispatching}

@fixme{only a small library}



@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node epsilonian features
@subsection epsilonian features

@fixme{Write this}

@xref{Interaction example} for a quick demo session introducing most
of the non-traditional features which might surprise a Lisp user.


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node License
@section License

@cindex free software
@cindex GPL
@cindex GNU General Public License
@cindex General Public License
@cindex license, for JitterLisp
@cindex software, license
JitterLisp is free software, distributed under the GNU General Public
License, version 3 or later.
@ifset includelicenses
  @xref{GNU General Public License} for the full text of the software license.
@end ifset @c includelicenses
@cindex no warranty
@cindex warranty, lack thereof
There is no warranty.

@cindex free documentation
@cindex FDL
@cindex GNU Free Documentation License
@cindex Free Documentation License
@cindex license, for this manual
@cindex manual, license
This manual is free documentation, distributed under the GNU Free
Documentation License, version 1.3 or later.
@ifset includelicenses
  @xref{GNU Free Documentation License} for the full text of the manual license.
@end ifset @c includelicenses


@c Here starts the actual documentation, written in a slightly more formal
@c tone but still in the first person singular.  I find it appropriate for the
@c JitterLisp's manual to have a less formal tone than Jitter's.

@c Using JitterLisp
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Using JitterLisp
@chapter Using JitterLisp
@cindex usage (JitterLisp)

@cindex C
@cindex source
@cindex distribution
JitterLisp is written in C and in itself, and its source code is
distributed along with Jitter as an advanced example of its use.

@cindex cross compilation
@cindex GNU build system
@cindex GNU conventions, build system
@cindex build system
@cindex distribution
@cindex Jitter
JitterLisp has no separate distribution or build system of its own,
but is easy to build from the Jitter build directory.  The build
process follows the GNU conventions, and supports cross-compilation.

@menu
* Obtaining the software::                 Where to download from.
* Building JitterLisp::                    JitterLisp is easy to build at
                                           the same time as Jitter.
* Installing JitterLisp::                  No need to.
* Invoking @command{jitterlisp}::                    The command line interface.
* Interaction example::                    A demo session showing the main
                                           features.
@end menu


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Obtaining the software
@section Obtaining the software

@cindex obtaining (JitterLisp)
@cindex downloading (JitterLisp)
@cindex distribution (JitterLisp)

@cindex git
JitterLisp is distributed as an example within Jitter, and can be
obtained along with the Jitter source code.  The current web page for
Jitter, containing a link to a publicly readable git repository, is
on my web site at the URL @url{http://ageinghacker.net/projects/jitter/}.

@cindex branch, git
@cindex git branch
@cindex @code{jitterlisp}, git branch
@cindex @code{master}, git branch
As of early 2018 JitterLisp's development takes place on the
@code{jitterlisp} git branch, to be merged into @code{master} as soon
as the code approaches a stable form.

@cindex feedback
@cindex contacting the author
@cindex author, contacting
@cindex Luca Saiu, contacting
@cindex Saiu, Luca, contacting
I welcome feedback.  If you need to contact me or want to discuss about
JitterLisp please
@pxref{Contacting the author,,, jitter, The Jitter Manual}.


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Building JitterLisp
@section Building JitterLisp

JitterLisp belongs to Jitter's examples.  The examples are not built
by the default @command{make} target but are easy to generate by building
the @code{examples} target from the Jitter build directory.

@cindex test suite, Jitter
@fixme{Update this and merge into the paragraph above after adding JitterLisp
test cases to the test suite.}
JitterLisp appears very useful as a way to stress Jitter and test its
generated code.
@cindex branch, git
@cindex git branch
@cindex @code{jitterlisp}, git branch
@cindex @code{master}, git branch
@cindex @code{check}, make target (Jitter)
@cindex @command{make check} (Jitter)
@cindex test suite (Jitter)
After merging the @code{jitterlisp} git branch into @code{master} I plan
to add test cases using JitterLisp to the Jitter test suite.  At that point
running Jitter's test suite with
@command{make check}
(@pxref{Running the test suite,,, jitter, The Jitter Manual})
will become sufficient to build JitterLisp as a side effect.

@cindex cross compilation
@cindex Jitter
@cindex GNU Coding Standards
@cindex GNU build system
@cindex Coding Standards, GNU
@cindex build system, GNU
@cindex GNU Autoconf
@cindex GNU Automake
@cindex Autoconf
@cindex Automake
@xref{Working with the Jitter sources,,, jitter, The Jitter Manual} for
detailed building instructions.  The build system follows the GNU conventions
and in particular the common practice and suggestions from the GNU Coding
Standards
(@pxref{Top,,, standards, The GNU Coding Standards}), which sets a few
additional requirements for ``developers'' including GNU Autoconf and GNU
Automake.
@cindex Boehm-Demers garbage collector
@cindex GC, Boehm-Demers
@cindex Readline
@cindex GNU Readline
Even if the dependency is not mandatory I strongly recommend the
Boehm-Demers garbage collector, packaged by every modern GNU/Linux
distributions and also easy to install from sources.  Another optional
dependency is the GNU Readline library.

@cindex cross compiling
@cindex directory, build (Jitter)
@cindex build directory (Jitter)
A separate build directory is supported, and encouraged.
Cross-compilation is also well supported.

@fixme{different executables}

@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Installing JitterLisp
@section Installing JitterLisp

@fixme{add a jitterlisp-install target, just for resolving Libtool libraries.}

@cindex installing (by hand, for the time being)
The Jitter build system does not support installing examples at the
present time.

As a workaround it is possible to configure JitterLisp
to generate static libraries only by configuring with
@option{--disable-shared},
and then build the examples.  Each JitterLisp executable will be one
self-contained file with no external run-time dependencies, easy to
copy by hand into some directory from @env{PATH}.
@cindex library file, JitterLisp
@cindex license, text in JitterLisp executables
@cindex GPL
@cindex GNU General Public License
If JitterLisp libraries are statically linked and every dynamic
library is installed then the JitterLisp executables will not access
any other file by default: the JitterLisp library file and the GPL
license text are in fact embedded as constants within the native
compiled file image (@pxref{constant-strings}).


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@c This node name is required by the GNU Coding Standards.  However nothing
@c requires it to be a *chapter* name.
@node Invoking @command{jitterlisp}
@section Invoking @command{jitterlisp}
@cindex invoking
@cindex command line
@cindex @command{jitterlisp}, invoking

@fixme{Write this}


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Interaction example
@section Interaction example

@fixme{Write this}

@fixme{@code{+} is a macro}

@fixme{look at an interpreted closure}

@fixme{@code{macroexpand}}

@fixme{do some simple computation over ASTs}

@fixme{optimize explicitly}

@fixme{optimize retroactively}



@c Lisp language form reference
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@node Lisp data
@chapter Lisp data

@fixme{Write this}

@menu
* Types::                                     Every possible shape of data.
* Mapping Lisp data to expressions::          Homoiconicity.
@end menu

@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Types
@section Types

Every Lisp datum contains a @dfn{value} and a @dfn{type}.  Given a
datum it is always possible to check for its type at run time by means
of some predefined procedure (@pxref{type-checking-procedures}).

Since JitterLisp has, at least currently, no subtyping relation, each
object belongs to exactly one of the following types.  However some
predefined procedures are provided to check whether an object belongs
to one of several related data types; for example @code{closure?} will
accept either an interpreted closure or a compiled closure as a
``closure''.

@anchor{type-table}
@table @emph
@cindex fixnum
@item fixnum

@cindex unique
@item unique type

@cindex character
@item character

@cindex symbol
@item symbol

@cindex interpreted closure
@item interpreted closure

@cindex compiled closure
@item compiled closure
@fixme{An interpreted closure can destructively change to a compiled
closure (but not vice-versa) without changing its identity.}

@cindex primitive
@item primitive

@cindex AST
@cindex Abstract Syntax Tree
@item AST

@cindex box
@item box

@cindex cons
@item cons

@cindex macro (type)
@item macro

@cindex primitive macro
@item primitive macro

@end table

@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Mapping Lisp data to expressions
@section Mapping Lisp data to expressions


@c Lisp language reference
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@node Lisp language reference
@chapter Lisp language reference

@fixme{Write this}

@menu
* Constants::                                 Some symbols can't be globally
                                              mutated.
@end menu

@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Constants
@section Constants
@fixme{primitive wrappers are global constants}


@c Lisp language form reference
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@node Lisp language form reference
@chapter Lisp language form reference

@fixme{Write this.}

The distinction between language and library is not clear-cut in a
system like JitterLisp with strong syntactic abstraction, where almost
all of the language is implemented in itself.  Here I present the
linguistic features which are ``fundamental'' in a conceptual way,
independently from the way they are implemented.

Users interested in distinguishing which individual feature is
implemented in C rather than as a macro may check the tag (``macro''
or ``core macro'', and only occasionally in this chapter ``primitive wrapper'')
in the documentation of each item and then follow the
sources, with the caveat that a few (important) forms are implemented
more than once: first by a temporary definition in C, in order to run
the library and initialize the global state; then, from the library
itself, the feature is re-defined in Lisp in a more general or
powerful way.

@fixme{Write this}

@fixme{lexical scoping}

@fixme{left-to-right}

@fixme{case sensitive}

@fixme{metasyntactic conventions: the dot}

@fixme{erroring out}

@menu
* Language forms::                            The stuff programs are made of.
@end menu

@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Language forms
@section Language forms
@cindex form, language
@cindex language form

@fixme{Write something}

@fixme{There is a lot of redundancy, by design.  It is desirable to
use the most specific form available, for readability and occasionally
also for efficiency's sake.}

@menu
* Definitions::              Adding or changing global variable bindings.
* Sequencing::               Executing multiple forms one after the other.
* Conditionals::             Evaluating different forms according to the result of another.
* Procedures::               Making anonymous procedure objects or ``closures''.
* Blocks::                   Establishing local variable bindings.
* Assignment::               Changing existing variable bindings.
* Loops::                    Performing the same action multiple times.
* Macros::                   Making macros.
* Quoting and quasiquoting:: Building literal or mostly literal objects.
@end menu

@c @@@@@@@@@@@
@node Definitions
@subsection Definitions

@syindex define
@deffn  {macro} define defined-thing . forms
@syindex define-constant
@deffnx {macro} define-constant defined-thing . forms
@syindex define-non-optimized
@deffnx {macro} define-non-optimized defined-thing . forms
@syindex define-constant-non-optimized
@deffnx {macro} define-constant-non-optimized defined-thing . forms
@fixme{Write this}
@end deffn

@anchor{define-macro}
@syindex define-macro
@deffn  {macro} define-macro (name . args-pattern) . forms
@end deffn

@syindex macrolet@r{ (non-existing form)}
There is currently no syntactic support for local macros, such as
Common Lisp's @code{macrolet}.


@c @@@@@@@@@@@
@node Sequencing
@subsection Sequencing

@cindex sequencing
@fixme{sequencing is nice}

@fixme{``implicit @code{progn}'' or ``implicit @code{begin}''}

@syindex begin
@deffn {macro} begin . forms
@fixme{Write this}
@end deffn

@syindex begin-from-first
@deffn {macro} begin-from-first index . forms
@fixme{Write this}
@end deffn

@syindex begin1
@syindex begin2
@syindex begin3
@syindex begin4
@deffn {macro} begin1 form-1 . other-forms
@deffnx {macro} begin2 form-1 form-2 . other-forms
@deffnx {macro} begin3 form-1 form-2 form-3 . other-forms
@deffnx {macro} begin4 form-1 form-2 form-3 form-4 . other-forms
@fixme{Write this}
@end deffn

@syindex begin-from-last
@deffn {macro} begin-from-last index . forms
@fixme{Write this}
@end deffn

@syindex begin-1
@syindex begin-2
@syindex begin-3
@syindex begin-4
@deffn {macro} begin-1 form-1 . other-forms
@deffnx {macro} begin-2 form-1 form-2 . other-forms
@deffnx {macro} begin-3 form-1 form-2 form-3 . other-forms
@deffnx {macro} begin-4 form-1 form-2 form-3 form-4 . other-forms
@fixme{Write this}

@code{begin-1} is only provided for symmetry, and is functionally
equivalent to @code{begin} with the restriction of requiring at least
one form.
@end deffn


@c @@@@@@@@@@@
@node Conditionals
@subsection Conditionals

@cindex conditional
A @dfn{conditional} form consists in evaluating some @dfn{condition}
form and then decide which form to evaluate next according to the
result of the condition.

@syindex if
@deffn {core macro} if condition then-form . else-forms
@fixme{Write this}
@end deffn

@syindex when
@deffn {macro} when condition . forms
@fixme{Write this}
@end deffn

@syindex unless
@deffn {macro} unless condition . forms
@fixme{Write this}
@end deffn

@syindex cond
@deffn {macro} cond . clauses
@fixme{Write this}
@end deffn

@syindex case
@deffn {macro} case discriminand . clauses
@fixme{Write this}
@end deffn


@c @@@@@@@@@@@
@node Procedures
@subsection Procedures

@anchor{lambda}
@syindex lambda
@deffn {core macro} lambda formals . forms
@end deffn


@c @@@@@@@@@@@
@node Blocks
@subsection Blocks

@cindex block
A @dfn{block} introduces a scope where some variables are locally
bound.

@cindex lexical scoping
@cindex static scoping
@cindex scoping, lexical
Following a lexical scoping discipline a variable binding is visible
in the syntactic region where it has been bound and in every callee,
as long as it is not shadowed by an inner binding for the same
variable.

@anchor{let}
@syindex let
@syindex let*
@syindex letrec
@syindex @r{named} let
@syindex let@r{, named}
@deffn {macro} let bindings . forms
@deffnx {core macro} let* bindings . forms
@deffnx {macro} letrec bindings . forms
@deffnx {macro} let name bindings . forms
@fixme{Write this}

The fourth variant, with @var{name} being a symbol, is listed here out of completeness
but belongs with looping forms; @pxref{named-let,, named @code{let}} for its description.
@end deffn

@anchor{destructuring-bind}
@syindex destructuring-bind
@deffn {macro} destructuring-bind pattern structure . forms
@cindex template (Common Lisp)
@cindex pattern
@fixme{Write this.  Common Lisp calls ``template'' what I call ``pattern''.}
@end deffn

@c @@@@@@@@@@@
@node Assignment
@subsection Assignment

@cindex assignment
An @dfn{assignment} operation destructively modifies an existing variable binding.

@syindex set!
@deffn {core macro} set! x . forms
Evaluate the forms @var{forms} left-to-right, then assign the result of the last one
(or @code{#<nothing>} if no forms were given) to the innermost binding for the variable
@var{x}.

Error out if @var{x} is not a symbol, if @var{x} is unbound, or if the binding for
@var{x} is global and constant.
@end deffn

@cindex constant
@anchor{constants}
@fixme{speak about constants}
@quotation Rationale
@fixme{efficiency of compiled code}
@end quotation

@syindex make-constant!
@deffn {primitive wrapper} make-constant! x
@fixme{write.  @var{x} must be a symbol.  It is allowed to be lexically bound as well.
  If called on a globally unbound symbol, it becomes impossible to ever assign
  @emph{or define} it.}
@end deffn

@c @@@@@@@@@@@
@node Loops
@subsection Loops

@cindex loop
A @dfn{loop} form consists in executing the same @dfn{body forms} potentially multiple
times, in sequence.

@syindex while
@deffn {core macro} while guard . forms
@fixme{Write this}
@end deffn

@syindex do
@deffn {macro} do clauses (guard . result-forms) . body-forms
@fixme{Write this}
@end deffn

@syindex dotimes
@syindex dotimesdown
@deffn  {macro} dotimes (x count-form . result-forms) . body-forms
@deffnx {macro} dotimesdown (x count-form . result-forms) . body-forms
@fixme{Write this}
@end deffn

@syindex dolist
@deffn {macro} dolist (x list-form . result-forms) . body-forms
@fixme{Write this}
@end deffn

@anchor{named-let}
@syindex named-let
@deffn  {macro} named-let name bindings . forms
@syindex @r{named} let
@syindex let@r{, named}
@deffnx {macro} let name bindings . forms
@fixme{Write this}

The other, simpler, syntax for @code{let} is described among block
forms: @pxref{let,, @code{let}}.
@end deffn

@c @@@@@@@@@@@
@node Macros
@subsection Macros

@syindex low-level-macro
@deffn {core macro} low-level-macro . forms
@syindex low-level-macro-args
@fixme{Write this.  Speak of @code{low-level-macro-args}}
@end deffn

@syindex macro
@deffn {macro} macro (macro-name . pattern) . forms
@fixme{Write this.  This uses @code{destructuring bind}
@pxref{destructuring-bind}}
@end deffn

@syindex define
@syindex define-macro
The macros above would suffice, along with @code{define}, for globally
binding macros.  However @code{define-macro} is provided as a more convenient
syntax: @pxref{define-macro} for a global macro-defining facility.


@c @@@@@@@@@@@
@node Quoting and quasiquoting
@subsection Quoting and quasiquoting

@cindex quoting
@syindex quote
@deffn {core macro} quote thing
@end deffn

@cindex quasiquoting
@syindex quasiquote
@syindex unquote
@syindex unquote-splicing
@deffn {macro} quasiquote template
@end deffn

@syindex quote
@syindex quasiquote
@syindex unquote
@syindex unquote-splicing
@syindex '@r{ (apostrophe, prefix for @code{quote})}
@syindex `@r{ (backtick, prefix for @code{quasiquote})}
@syindex ,@r{ (comma, prefix for @code{unquote})}
@syindex ,@@@r{ (comma at, prefix for @code{unquote-splicing})}
@fixme{speak of prefixes}

@c Lisp library reference
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@node Lisp library reference
@chapter Lisp library reference

@fixme{Write this}

@fixme{Every symbol documented here is a global constant, except for
macros; it is convenient to be able to re-define macros in a
backwards-compatible way}


@menu
* Type checking::                     Testing a datum's type at run time.
* Boolean operations::                Working with booleans.
* Arithmetic::                        Operations on numbers.
* Number comparison::                 Comparing numbers.
* Symbol handling::                   Working with symbols.
* Box handling::                      Working with boxes.
* Cons handling::                     Working with conses.
* List handling::                     Working with list-shaped objects.
* Alist handling::                    Working with association lists.
* Higher order::                      Procedures working with procedures.
* Variadic utility::                  Helpers for defining variadic macros.
* Sets as lists::                     Sets as unordered list of elements
                                      compared with @code{eq?}.
* AST operations::                    Working with Abstract Syntax Trees.
* Macroexpanding::                    Explicitly expanding macros from user
                                      code.
* Interpreting::                      @code{eval}, @code{apply} and friends.
* Input and output::                  How to read and write.
* Unclassified::                      stuff to move
@end menu


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Type checking
@section Type checking

@cindex type checking
@cindex checking, type
@anchor{type-checking-procedures}

@menu
* Actual type checking::                    Testing an object type.
* Pseudo-type checking::                    Testing an object type and shape.
@end menu

@c @@@@@@@@@@@@
@node Actual type checking
@subsection Actual type cheking

@fixme{``Actual'' is a terrible word to use here.}

@fixme{Write.  These return a canonical boolean and never fail.}

@syindex fixnum?
@deffn  {primitive wrapper} fixnum?
@syindex boolean?
@deffnx {primitive wrapper} boolean?
@syindex character?
@deffnx {primitive wrapper} character?
@syindex null?
@deffnx {primitive wrapper} null?
@syindex eof?
@deffnx {primitive wrapper} eof?
@syindex nothing?
@deffnx {primitive wrapper} nothing?
@syindex undefined?
@deffnx {primitive wrapper} undefined?
@syindex box?
@deffnx {primitive wrapper} box?
@syindex symbol?
@deffnx {primitive wrapper} symbol?
@syindex cons?
@deffnx {primitive wrapper} cons?
@syindex primitive?
@deffnx {primitive wrapper} primitive?
@syindex primitive-macro?
@deffnx {primitive wrapper} primitive-macro?
@syindex macro?
@deffnx {primitive wrapper} macro?
@syindex interpreted-closure?
@deffnx {primitive wrapper} interpreted-closure?
@syindex compiled-closure?
@deffnx {primitive wrapper} compiled-closure?
@syindex ast?
@deffnx {primitive wrapper} ast?
@end deffn

@syindex non-null?
@syindex non-cons?
@syindex non-symbol?
@deffn  {primitive wrapper} non-null?
@deffnx {primitive wrapper} non-cons?
@deffnx {primitive wrapper} non-symbol?
@end deffn

@c @@@@@@@@@@@@
@node Pseudo-type checking
@subsection Pseudo-type checking

@syindex number?
@deffn {procedure} number?
@end deffn

@syindex closure?
@deffn {procedure} closure?
@end deffn

@syindex list?
@deffn {procedure} list?
@end deffn

@syindex symbols?
@deffn {procedure} symbols?
@end deffn

@syindex alist?
@deffn {procedure} alist? x
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Boolean operations
@section Boolean operations

@syindex not
@deffn {primitive wrapper} not x
@end deffn

@syindex or
@deffn  {macro} or . clauses
@syindex lispy-or
@deffnx {macro} lispy-or . clauses
@end deffn

@syindex and
@deffn  {macro} and . clauses
@syindex lispy-and
@syindex lispy-or  @c Not a mistake: there is a reference.
@deffnx {macro} lispy-and . clauses
@fixme{@code{lispy-and} is provided just for symmetry with @code{lispy-or},
and is in fact an alias for @code{and}, the traditional Lisp
definition does introducing no inefficiencies in this case.}
@end deffn

@syindex boolean-canonicalize
@deffn {primitive wrapper} boolean-canonicalize x
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Arithmetic
@section Arithmetic

@fixme{fixnum only for the time being}

@syindex negate
@deffn  {primitive wrapper} negate x
@end deffn

@syindex 1+
@deffn  {primitive wrapper} 1+ x
@syindex 1-
@deffnx {primitive wrapper} 1- x
@end deffn

@syindex 2*
@deffn  {primitive wrapper} 2* x
@syindex 2/
@deffnx {primitive wrapper} 2/ x
@syindex 2quotient
@deffnx {primitive wrapper} 2quotient x
@syindex 2remainder
@deffnx {primitive wrapper} 2remainder x
@end deffn

@syindex primordial-+
@deffn  {primitive wrapper} primordial-+ x y
@syindex primordial--
@deffnx {primitive wrapper} primordial-- x y
@syindex primordial-*
@deffnx {primitive wrapper} primordial-* x y
@syindex primordial-/
@deffnx {primitive wrapper} primordial-/ x y
@syindex primordial-quotient
@deffnx {primitive wrapper} primordial-quotient x y
@syindex primordial-remainder
@deffnx {primitive wrapper} primordial-remainder x y
@end deffn

@syindex *-by-sums-procedure
@deffn {procedure} *-by-sums-procedure x y
@end deffn

@syindex **-procedure
@deffn {procedure} **-procedure b e
@end deffn

@syindex +
@deffn  {macro} + . args
@syindex *
@deffnx {macro} * . args
@syindex *-by-sums
@deffnx {macro} *-by-sums . args
@syindex **
@deffnx {macro} ** . args
@end deffn

@syindex -
@deffn {macro} - . args
@end deffn

@syindex /
@deffn {macro} / . args
@end deffn

@syindex square
@deffn {procedure} square x
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Number comparison
@section Number comparison

@fixme{fixnum only for the time being}

@syindex zero?
@deffn  {primitive wrapper} zero? x
@syindex non-zero?
@deffnx {primitive wrapper} non-zero? x
@syindex positive?
@deffnx {primitive wrapper} positive? x
@syindex non-positive?
@deffnx {primitive wrapper} non-positive? x
@syindex negative?
@deffnx {primitive wrapper} negative? x
@syindex non-negative?
@deffnx {primitive wrapper} non-negative? x
@end deffn

@syindex =
@deffn  {primitive wrapper} = x y
@syindex <
@deffnx {primitive wrapper} < x y
@syindex >
@deffnx {primitive wrapper} > x y
@syindex <=
@deffnx {primitive wrapper} <= x y
@syindex >=
@deffnx {primitive wrapper} >= x y
@syindex <>
@deffnx {primitive wrapper} <> x y
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Symbol handling
@section Symbol handling

@syindex gensym
@deffn {primitive wrapper} gensym
@end deffn

@syindex interned-symbols
@deffn {primitive wrapper} interned-symbols
@end deffn

@syindex symbol-global
@deffn {primitive wrapper} symbol-global s
@end deffn

@syindex make-constant!
@deffn {primitive wrapper} make-constant! s
@end deffn

@syindex constant?
@deffn {primitive wrapper} constant? s
@end deffn

@syindex defined?
@deffn {primitive wrapper} defined? s
@end deffn

@syindex undefine
@deffn {primitive wrapper} undefine s
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Box handling
@section Box handling

@syindex box
@deffn {primitive wrapper} box x
@end deffn

@syindex box-get
@deffn {primitive wrapper} box-get b
@end deffn

@syindex box-set!
@deffn {primitive wrapper} box-set! b x
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Cons handling
@section Cons handling

@syindex cons
@deffn {primitive wrapper} cons a b
@end deffn

@syindex car
@deffn  {primitive wrapper} car c
@syindex cdr
@deffnx {primitive wrapper} cdr c
@end deffn

@syindex caar
@deffn  {procedure} caar c
@syindex cdar
@deffnx {procedure} cdar c
@syindex cadr
@deffnx {procedure} cadr c
@syindex cddr
@deffnx {procedure} cddr c
@syindex caaar
@deffnx {procedure} caaar c
@syindex cadar
@deffnx {procedure} cadar c
@syindex caadr
@deffnx {procedure} caadr c
@syindex caddr
@deffnx {procedure} caddr c
@syindex cdaar
@deffnx {procedure} cdaar c
@syindex cddar
@deffnx {procedure} cddar c
@syindex cdadr
@deffnx {procedure} cdadr c
@syindex cdddr
@deffnx {procedure} cdddr c
@syindex caaaar
@deffnx {procedure} caaaar c
@syindex caadar
@deffnx {procedure} caadar c
@syindex caaadr
@deffnx {procedure} caaadr c
@syindex caaddr
@deffnx {procedure} caaddr c
@syindex cadaar
@deffnx {procedure} cadaar c
@syindex caddar
@deffnx {procedure} caddar c
@syindex cadadr
@deffnx {procedure} cadadr c
@syindex cadddr
@deffnx {procedure} cadddr c
@syindex cdaaar
@deffnx {procedure} cdaaar c
@syindex cdadar
@deffnx {procedure} cdadar c
@syindex cdaadr
@deffnx {procedure} cdaadr c
@syindex cdaddr
@deffnx {procedure} cdaddr c
@syindex cddaar
@deffnx {procedure} cddaar c
@syindex cdddar
@deffnx {procedure} cdddar c
@syindex cddadr
@deffnx {procedure} cddadr c
@syindex cddddr
@deffnx {procedure} cddddr c
@end deffn

@syindex set-car!
@deffn  {primitive wrapper} set-car! c x
@syindex set-cdr!
@deffnx {primitive wrapper} set-cdr! c x
@end deffn

@syindex set-caar!
@deffn  {procedure} set-caar! c
@syindex set-cdar!
@deffnx {procedure} set-cdar! c
@syindex set-cadr!
@deffnx {procedure} set-cadr! c
@syindex set-cddr!
@deffnx {procedure} set-cddr! c
@syindex set-caaar!
@deffnx {procedure} set-caaar! c
@syindex set-cadar!
@deffnx {procedure} set-cadar! c
@syindex set-caadr!
@deffnx {procedure} set-caadr! c
@syindex set-caddr!
@deffnx {procedure} set-caddr! c
@syindex set-cdaar!
@deffnx {procedure} set-cdaar! c
@syindex set-cddar!
@deffnx {procedure} set-cddar! c
@syindex set-cdadr!
@deffnx {procedure} set-cdadr! c
@syindex set-cdddr!
@deffnx {procedure} set-cdddr! c
@syindex set-caaaar!
@deffnx {procedure} set-caaaar! c
@syindex set-caadar!
@deffnx {procedure} set-caadar! c
@syindex set-caaadr!
@deffnx {procedure} set-caaadr! c
@syindex set-caaddr!
@deffnx {procedure} set-caaddr! c
@syindex set-cadaar!
@deffnx {procedure} set-cadaar! c
@syindex set-caddar!
@deffnx {procedure} set-caddar! c
@syindex set-cadadr!
@deffnx {procedure} set-cadadr! c
@syindex set-cadddr!
@deffnx {procedure} set-cadddr! c
@syindex set-cdaaar!
@deffnx {procedure} set-cdaaar! c
@syindex set-cdadar!
@deffnx {procedure} set-cdadar! c
@syindex set-cdaadr!
@deffnx {procedure} set-cdaadr! c
@syindex set-cdaddr!
@deffnx {procedure} set-cdaddr! c
@syindex set-cddaar!
@deffnx {procedure} set-cddaar! c
@syindex set-cdddar!
@deffnx {procedure} set-cdddar! c
@syindex set-cddadr!
@deffnx {procedure} set-cddadr! c
@syindex set-cddddr!
@deffnx {procedure} set-cddddr! c
@end deffn

@syindex cdr-or-nil
@deffn {procedure} cdr-or-nil c
@end deffn

@syindex improper-list
@deffn  {macro} improper-list first-element . more-elements
@syindex cons*
@deffnx {macro} cons* first-element . more-elements
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node List handling
@section List handling

@syindex singleton
@deffn {procedure} singleton
@end deffn

@syindex list
@deffn {macro} list . elements
@end deffn

@syindex circular-list
@deffn {macro} circular-list first-element . more-elements
@end deffn

@syindex replicate
@deffn  {procedure} replicate n x
@syindex make-list
@deffnx {procedure} make-list n x
@end deffn

@syindex last-cons
@deffn {procedure} last-cons xs
@end deffn

@syindex last
@deffn {procedure} last xs
@end deffn

@syindex all-but-last
@deffn  {procedure} all-but-last xs
@syindex all-but-last-reversed
@deffnx {procedure} all-but-last-reversed xs
@end deffn

@syindex length
@deffn {procedure} length xs
@end deffn

@syindex reverse
@deffn  {procedure} reverse xs
@syindex reverse!
@deffnx {procedure} reverse! xs
@end deffn

@syindex append-procedure
@deffn  {procedure} append-procedure xs ys
@syindex append-reversed
@deffnx {procedure} append-reversed xs ys
@syindex append!
@deffnx {procedure} append! xs ys
@end deffn

@syindex append
@deffn  {macro} append . xss
@end deffn

@syindex flatten
@deffn  {procedure} flatten xss
@syindex flatten!
@deffnx {procedure} flatten! xss
@syindex flatten-reversed
@deffnx {procedure} flatten-reversed xss
@syindex flatten-reversed!
@deffnx {procedure} flatten-reversed! xss
@end deffn

@syindex list-copy
@deffn {procedure} list-copy xs
@end deffn

@syindex nth-cons
@deffn  {procedure} nth-cons xs n
@syindex nth-cons-or-nil
@deffnx {procedure} nth-cons-or-nil xs n
@end deffn

@syindex nth
@deffn {procedure} nth xs n
@end deffn

@syindex take
@deffn  {procedure} take xs n
@syindex take-reversed
@deffnx {procedure} take-reversed xs n
@syindex take!
@deffnx {procedure} take! xs n
@end deffn

@syindex drop
@deffn  {procedure} drop xs n
@syindex drop!
@deffnx {procedure} drop! xs n
@end deffn

@syindex zip
@deffn  {procedure} zip xs n
@syindex zip-reversed
@deffnx {procedure} zip-reversed xs n
@end deffn

@syindex unzip
@deffn  {procedure} unzip xs n
@syindex unzip-reversed
@deffnx {procedure} unzip-reversed xs n
@end deffn

@syindex map
@deffn  {procedure} map f xs
@syindex map-reversed
@deffnx {procedure} map-reversed f xs
@syindex map!
@deffnx {procedure} map! f xs
@end deffn

@syindex fold-left
@deffn {procedure} fold-left f x xs
@end deffn

@syindex fold-right
@deffn  {procedure} fold-right f xs y
@syindex fold-right!
@deffnx {procedure} fold-right! f xs y
@end deffn

@syindex exists?
@deffn  {procedure} exists? p xs
@syindex for-all?
@deffnx {procedure} for-all? p xs
@end deffn

@syindex filter
@deffn  {procedure} filter p xs
@syindex filter-reversed
@deffnx {procedure} filter-reversed p xs
@end deffn

@syindex range
@deffn  {procedure} range a b
@syindex range-reversed
@deffnx {procedure} range-reversed a b
@end deffn

@syindex iota
@deffn {procedure} iota n
@end deffn

@syindex sort
@deffn {procedure} sort xs
@end deffn

@syindex list-has?
@deffn {procedure} list-has? xs x
@end deffn

@syindex list-without
@deffn  {procedure} list-without xs x
@syindex list-without!
@deffnx {procedure} list-without! xs x
@end deffn

@syindex all-different?
@deffn {procedure} all-different?
@fixme{quadratic}
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Alist handling
@section Alist handling

@syindex assq
@deffn {procedure} assq key alist
@end deffn

@syindex rassq
@deffn {procedure} rassq value alist
@end deffn

@syindex del-assq-1
@deffn {procedure} del-assq-1 key alist
@end deffn

@syindex del-assq
@deffn  {procedure} del-assq key alist
@syindex del-assq-noncopying
@deffnx {procedure} del-assq-noncopying key alist
@end deffn

@syindex del-assq-list
@deffn  {procedure} del-assq-list keys alist
@syindex del-assq-list-noncopying
@deffnx {procedure} del-assq-list-noncopying keys alist
@end deffn

@syindex alist-copy
@deffn {procedure} alist-copy alist
@end deffn

@syindex alist-get
@deffn {procedure} alist-get key alist
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Higher order
@section Higher order

@syindex compose-procedure
@deffn  {procedure} compose-procedure f g
@syindex compose-eta
@deffnx {procedure} compose-eta f g
@end deffn

@syindex compose
@deffn  {macro} compose . fs
@syindex compose-pipeline
@deffnx {macro} compose-pipeline . fs
@end deffn

@syindex square-function
@deffn  {procedure} square-function f
@syindex square-function-eta
@deffnx {procedure} square-function-eta f
@end deffn

@syindex iterate
@deffn  {procedure} iterate f n
@syindex iterate-eta
@deffnx {procedure} iterate-eta f n
@syindex iterate-pre
@deffnx {procedure} iterate-pre f n
@syindex iterate-post
@deffnx {procedure} iterate-post f n
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Variadic utility
@section Variadic utility

@syindex define-left-nested-variadic-extension
@deffn  {macro} define-left-nested-variadic-extension operator original-name neutral
@syindex define-right-nested-variadic-extension
@deffnx {macro} define-right-nested-variadic-extension operator original-name neutral
@syindex define-associative-variadic-extension
@deffnx {macro} define-associative-variadic-extension operator original-name neutral
@end deffn

@fixme{yes, the things that follow are really procedures}

@syindex variadic-left-deep
@deffn  {procedure} variadic-left-deep rator neutral rands
@syindex variadic-right-deep
@deffnx {procedure} variadic-right-deep rator neutral rands
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Sets as lists
@section Sets as lists

@fixme{Performance caveat}

@fixme{order caveat}

@fixme{The word ``set'' as used here refers to a collection of objects in the
mathematical sense, and has nothing to do with the action of ``setting'' as
performed by @code{set-@var{thing}!} procedures.}

@syindex set-empty
@deffn {non-procedure} set-empty
@end deffn

@syindex set-empty?
@deffn {procedure} empty? s
@end deffn

@syindex set-singleton
@deffn {procedure} set-singleton x
@end deffn

@syindex set
@deffn  {macro} set . elements
@end deffn

@syindex set-has?
@deffn {procedure} set-has? s x
@end deffn

@syindex set-with
@deffn {procedure} set-with s x
@end deffn

@syindex set-without
@deffn {procedure} set-without s x
@end deffn

@syindex set-unite-procedure
@deffn  {procedure} set-unite-procedure s1 s2
@syindex set-intersect-procedure
@deffnx {procedure} set-intersect-procedure s1 s2
@syindex set-subtract-procedure
@deffnx {procedure} set-subtract-procedure s1 s2
@end deffn

@syindex set-unite
@deffn  {macro} set-unite . sets
@syindex set-intersect
@deffnx {macro} set-intersect . sets
@syindex set-subtract
@deffnx {macro} set-subtract first-set . other-sets
@end deffn

@syindex list->set
@deffn  {procedure} list->set xs
@end deffn

@syindex set->list@r{ (non-existing procedure)}
@fixme{No @code{set->list} is needed}.


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node AST operations
@section AST operations

@fixme{if the argument is not an AST these all fail.}

@syindex ast-literal?
@deffn  {primitive wrapper} ast-literal?
@syindex ast-variable?
@deffnx {primitive wrapper} ast-variable?
@syindex ast-define?
@deffnx {primitive wrapper} ast-define?
@syindex ast-if?
@deffnx {primitive wrapper} ast-if?
@syindex ast-set!?
@deffnx {primitive wrapper} ast-set!?
@syindex ast-while?
@deffnx {primitive wrapper} ast-while?
@syindex ast-primitive?
@deffnx {primitive wrapper} ast-primitive?
@syindex ast-call?
@deffnx {primitive wrapper} ast-call?
@syindex ast-lambda?
@deffnx {primitive wrapper} ast-lambda?
@syindex ast-let?
@deffnx {primitive wrapper} ast-let?
@syindex ast-sequence?
@deffnx {primitive wrapper} ast-sequence?
@end deffn

@fixme{types: when we fail}

@syindex ast-literal
@deffn  {primitive wrapper} ast-literal value
@syindex ast-variable
@deffnx {primitive wrapper} ast-variable name
@syindex ast-define
@deffnx {primitive wrapper} ast-define name body
@syindex ast-if
@deffnx {primitive wrapper} ast-if condition then else
@syindex ast-set!
@deffnx {primitive wrapper} ast-set! name body
@syindex ast-while
@deffnx {primitive wrapper} ast-while guard body
@syindex ast-primitive
@deffnx {primitive wrapper} ast-primitive operator operands
@syindex ast-call
@deffnx {primitive wrapper} ast-call operator operands
@syindex ast-lambda
@deffnx {primitive wrapper} ast-lambda formals body
@syindex ast-let
@deffnx {primitive wrapper} ast-let bound-name bound-form body
@syindex ast-sequence
@deffnx {primitive wrapper} ast-sequence first second
@end deffn

@fixme{these fail if the argument is not an AST or if it's an AST of the
wrong case}
@fixme{no destructive operations right now.  They would be easy to
add, even if using them in an unrestricted way might destroy compiler
properties; anyway, it is already possible to destroy the same
compiler implied properties, by violating other unenforced invariants}

@syindex ast-literal-value
@deffn  {primitive wrapper} ast-literal-value ast
@syindex ast-variable-name
@deffnx {primitive wrapper} ast-variable-name ast
@syindex ast-define-name
@deffnx {primitive wrapper} ast-define-name ast
@syindex ast-define-body
@deffnx {primitive wrapper} ast-define-body ast
@syindex ast-if-condition
@deffnx {primitive wrapper} ast-if-condition ast
@syindex ast-if-then
@deffnx {primitive wrapper} ast-if-then ast
@syindex ast-if-else
@deffnx {primitive wrapper} ast-if-else ast
@syindex ast-set!-name
@deffnx {primitive wrapper} ast-set!-name ast
@syindex ast-set!-body
@deffnx {primitive wrapper} ast-set!-body ast
@syindex ast-while-guard
@deffnx {primitive wrapper} ast-while-guard ast
@syindex ast-while-body
@deffnx {primitive wrapper} ast-while-body ast
@syindex ast-primitive-operator
@deffnx {primitive wrapper} ast-primitive-operator ast
@syindex ast-primitive-operands
@deffnx {primitive wrapper} ast-primitive-operands ast
@syindex ast-call-operator
@deffnx {primitive wrapper} ast-call-operator ast
@syindex ast-call-operands
@deffnx {primitive wrapper} ast-call-operands ast
@syindex ast-lambda-formals
@deffnx {primitive wrapper} ast-lambda-formals ast
@syindex ast-lambda-body
@deffnx {primitive wrapper} ast-lambda-body ast
@syindex ast-let-bound-name
@deffnx {primitive wrapper} ast-let-bound-name ast
@syindex ast-let-bound-form
@deffnx {primitive wrapper} ast-let-bound-form ast
@syindex ast-let-body
@deffnx {primitive wrapper} ast-let-body ast
@syindex ast-sequence-first
@deffnx {primitive wrapper} ast-sequence-first ast
@syindex ast-sequence-second
@deffnx {primitive wrapper} ast-sequence-second ast
@end deffn

@fixme{An example showing a constuction, check and field access for the same case,
to highlight the lexical conventions.}


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Macroexpanding
@section Macroexpanding

@syindex macrolet@r{ (non-existing form)}
@fixme{There is currently no syntactic support for local macros, such as
Common Lisp's @code{macrolet}.}

@syindex primordial-macroexpand
@deffn {primitive wrapper} primordial-macroexpand form env
@end deffn

@syindex macroexpand
@deffn {macro} macroexpand form . optional-env
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Interpreting
@section Interpreting

@syindex apply
@deffn  {primitive wrapper} apply operator operands
@syindex apply-primitive
@deffnx {primitive wrapper} apply-primitive operator operands
@end deffn

@syindex primordial-eval
@deffn {primitive wrapper} primordial-eval form env
@end deffn

@syindex eval
@deffn {macro} eval form . optional-env
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Input and output
@section Input and output

@cindex GNU Readline
@cindex Readline
@cindex I/O
@cindex input
JitterLisp provides very crude I/O functionalities.  Files are not
implemented, so input and output only use the standard input and
standard output, respectively, or the terminal via ReadLine.

@menu
* Character I/O::                     Reading and writing one character at a time.
* Lisp object I/O::                   Reading and writing entire Lisp objects.
@end menu

@c @@@@@@@@@
@node Character I/O
@subsection Character I/O

@cindex character-based input/output
@cindex input/output, character-based

The following functionality provides a thin wrapper over C for reading
or writing one character at a time.

@syindex character-read
@deffn {primitive wrapper} character-read
Read a single character from the terminal and return it, or return @code{#<eof>}
if the input ends.

The implementation is a thin wrapper over the @code{getchar} function from the C library.
@end deffn

@syindex character-display
@deffn {primitive wrapper} character-display c
Print the single character @var{c} to the standard output.  Error out if
@var{c} is not a character object.
@end deffn

@syindex newline
@deffn {primitive wrapper} newline
Print a newline character to the standard output.

If @code{newline} were not already provided in the library it could be defined as:
@example
(define-constant (newline)
  (character-display #\newline))
@end example
@end deffn


@node Lisp object I/O
@subsection Lisp object I/O

@cindex object, Lisp, input/output
@cindex Lisp object, input/output
@cindex input/output, for Lisp objects

@syindex read
@deffn {primitive wrapper} read
@cindex Readline
Read one Lisp object in its input representation from the terminal, using the
Readline functionality if enabled, and return it.
Return @code{#<eof>} if the input ends @emph{before} an object is entered.

The input may span several lines and include whitespace or even Lisp comments, but
the read object must be exactly one.

Error out on syntax error, or if a second object starts after the first.
@end deffn

@syindex display
@deffn {primitive wrapper} display thing
Emit the printed representation of @var{thing} to the standard output.
No newline character or other terminator is added.
@end deffn


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@
@node Unclassified
@section Unclassified (move)

@syindex identity
@deffn {procedure} identity x
@end deffn

@syindex eq?
@deffn  {primitive wrapper} eq? x y
@syindex not-eq?
@deffnx {primitive wrapper} not-eq? x y
@end deffn

@syindex error
@deffn {primitive wrapper} error thing
@end deffn

@syindex copying
@deffn  {primitive wrapper} copying
@syindex no-warranty
@cindex no warranty
@cindex warranty, lack thereof
@deffnx {primitive wrapper} no-warranty
Display legal notices by printing, respectively, the full text of the GNU GPL
or an excerpt explaining how there is no warranty of any kind.
@end deffn


@c Internals
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@node Internals
@chapter Internals

@anchor{constant-strings}
@fixme{Write this}


@ifset includelicenses
@node GNU General Public License
@appendix GNU General Public License
@cindex GPL
@cindex GNU General Public License
@cindex software, license
@cindex license, for JitterLisp
@include gpl.texi

@node GNU Free Documentation License
@appendix GNU Free Documentation License
@cindex FDL
@cindex GNU Free Documentation License
@cindex documentation, license
@cindex manual, license
@cindex license, for this manual
@include fdl.texi
@end ifset @c includelicenses


@c Indices
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@node Symbol index
@unnumbered Symbol index

What follows is an alphabetical list of predefined JitterLisp globals,
without distinction between core definitions coming from the C code
and library definitions from the library written in Lisp and executed
at startup.

In the same sense the index glosses over the difference in type among
globally defined symbols: some may be procedures or primitive wrappers
and other macros, from either the core or the library.

@cindex symbol index
@cindex index, for symbols
@printindex sy


@node Concept index
@unnumbered Concept index

@cindex concept index
@cindex index, for concepts
@printindex cp


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@c The actual documentation for the user ends here.
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


@ifset preview
@c Stuff still to be written
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@node Stuff still to be written
@appendix Stuff still to be written

@fixme{Write this}


@c Stuff still to be implemented.
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@node Stuff still to be implemented
@appendix Stuff still to be implemented

@fixme{Write this}
@end ifset


@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@c Footer.
@c @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@bye
